module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},55561,e=>{"use strict";class t extends Error{constructor(e){super(e),this.name="ValidationError"}}function r(e){if(!e||"object"!=typeof e)throw new t("请求体必须是对象");if("string"!=typeof e.contactId||"string"!=typeof e.contactName||"string"!=typeof e.messageId||"string"!=typeof e.role||"string"!=typeof e.content||"string"!=typeof e.occurredAt||"string"!=typeof e.source)throw new t("请求字段格式无效");let r=e.contactId.trim(),n=e.contactName.trim(),o=e.messageId.trim(),a=e.role.trim(),s=e.content.trim(),i=e.occurredAt.trim(),c=e.source.trim();if(!r||r.length>64)throw new t("contactId 超出限制");if(!n||n.length>80)throw new t("contactName 超出限制");if(!o||o.length>64)throw new t("messageId 超出限制");if("user"!==a&&"assistant"!==a)throw new t("role 无效");if(!s||s.length>4e3)throw new t("content 超出限制");if("chat"!==c)throw new t("source 无效");let d=Date.parse(i);if(Number.isNaN(d))throw new t("occurredAt 时间格式无效");let l=e.extractedFields;if(void 0!==l){if(!l||"object"!=typeof l||Array.isArray(l))throw new t("extractedFields 格式无效");let e=Object.entries(l);if(e.length>50)throw new t("extractedFields 条目过多");for(let[r,n]of e){if("string"!=typeof n)throw new t("extractedFields 的值必须是字符串");if(!r.trim()||r.trim().length>64)throw new t("extractedFields 的键超出限制");if(n.trim().length>512)throw new t("extractedFields 的值超出限制")}}return{contactId:r,contactName:n,messageId:o,role:a,content:s,occurredAt:new Date(d).toISOString(),source:c,extractedFields:void 0===l?void 0:Object.fromEntries(Object.entries(l).map(([e,t])=>[e.trim(),t.trim()]))}}async function n(e,t=fetch){let r=await t(`${e.baseUrl}/open-apis/auth/v3/tenant_access_token/internal`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({app_id:e.appId,app_secret:e.appSecret}),signal:AbortSignal.timeout(1e4)});if(!r.ok)throw Error("获取飞书租户令牌失败");let o=await r.json();if(0!==o.code||!o.tenant_access_token)throw Error("获取飞书租户令牌失败");return o.tenant_access_token}async function o(e,t=fetch){var r;let a=await n(e.config,t),s=await t(`${e.config.baseUrl}/open-apis/bitable/v1/apps/${e.config.appToken}/tables/${e.config.tableId}/records`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({fields:{"Contact ID":(r=e.payload).contactId,"Contact Name":r.contactName,"Message ID":r.messageId,Role:r.role,Content:r.content,Source:r.source,"Occurred At":r.occurredAt,...r.extractedFields??{}}}),signal:AbortSignal.timeout(1e4)});if(!s.ok)throw Error("写入飞书多维表失败");let i=await s.json(),c=i.data?.record?.record_id;if(0!==i.code||!c)throw Error("写入飞书多维表失败");return{recordId:c}}e.s(["ValidationError",()=>t,"parseBitableSyncRequestBody",()=>r,"syncMessageToBitable",()=>o])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__3225e54e._.js.map